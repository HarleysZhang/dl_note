## å‰è¨€

åœ¨å…¨è¿æ¥å±‚æ„æˆçš„å¤šå±‚æ„ŸçŸ¥æœºç½‘ç»œä¸­ï¼Œæˆ‘ä»¬è¦é€šè¿‡å°†å›¾åƒæ•°æ®å±•å¹³æˆä¸€ç»´å‘é‡æ¥é€å…¥æ¨¡å‹ï¼Œä½†è¿™ä¼šå¿½ç•¥äº†æ¯ä¸ªå›¾åƒçš„**ç©ºé—´ç»“æ„ä¿¡æ¯**ã€‚ç†æƒ³çš„ç­–ç•¥åº”è¯¥æ˜¯è¦åˆ©ç”¨ç›¸è¿‘åƒç´ ä¹‹é—´çš„ç›¸äº’å…³è”æ€§ï¼Œå°†å›¾åƒæ•°æ®äºŒç»´çŸ©é˜µé€ç»™æ¨¡å‹ä¸­å­¦ä¹ ã€‚

å·ç§¯ç¥ç»ç½‘ç»œ(convolutional neural networkï¼Œ`CNN`)æ­£æ˜¯ä¸€ç±»å¼ºå¤§çš„ã€ä¸“ä¸ºå¤„ç†å›¾åƒæ•°æ®ï¼ˆå¤šç»´çŸ©é˜µï¼‰è€Œè®¾è®¡çš„ç¥ç»ç½‘ç»œï¼Œ`CNN` çš„è®¾è®¡æ˜¯æ·±åº¦å­¦ä¹ ä¸­çš„ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„æŠ€æœ¯ã€‚åœ¨ `Transformer` åº”ç”¨åˆ° `CV` é¢†åŸŸä¹‹å‰ï¼ŒåŸºäºå·ç§¯ç¥ç»ç½‘ç»œæ¶æ„çš„æ¨¡å‹åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸä¸­å ä¸»å¯¼åœ°ä½ï¼Œå‡ ä¹æ‰€æœ‰çš„å›¾åƒè¯†åˆ«ã€ç›®æ ‡æ£€æµ‹ã€è¯­ä¹‰åˆ†å‰²ã€3Dç›®æ ‡æ£€æµ‹ã€è§†é¢‘ç†è§£ç­‰ä»»åŠ¡éƒ½æ˜¯ä»¥ `CNN` æ–¹æ³•ä¸ºåŸºç¡€ã€‚

å·ç§¯ç¥ç»ç½‘ç»œæ ¸å¿ƒç½‘ç»œå±‚æ˜¯å·ç§¯å±‚ï¼Œå…¶ä½¿ç”¨äº†å·ç§¯(convolution)è¿™ç§æ•°å­¦è¿ç®—ï¼Œå·ç§¯æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿æ€§è¿ç®—ã€‚å¦å¤–ï¼Œé€šå¸¸æ¥è¯´ï¼Œå·ç§¯ç¥ç»ç½‘ç»œä¸­ç”¨åˆ°çš„å·ç§¯è¿ç®—å’Œå…¶ä»–é¢†åŸŸ(ä¾‹å¦‚å·¥ç¨‹é¢†åŸŸä»¥åŠçº¯æ•°å­¦é¢†åŸŸ)ä¸­çš„å®šä¹‰å¹¶ä¸å®Œå…¨ä¸€è‡´ã€‚

## ä¸€ï¼Œå·ç§¯

åœ¨ç†è§£å·ç§¯å±‚ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—ç†è§£ä»€ä¹ˆæ˜¯å·ç§¯æ“ä½œã€‚

å·ç§¯ä¸[å‚…é‡Œå¶å˜æ¢](https://zh.wikipedia.org/wiki/å‚…é‡Œå¶å˜æ¢)æœ‰ç€å¯†åˆ‡çš„å…³ç³»ã€‚ä¾‹å¦‚ä¸¤å‡½æ•°çš„å‚…é‡Œå¶å˜æ¢çš„ä¹˜ç§¯ç­‰äºå®ƒä»¬å·ç§¯åçš„å‚…é‡Œå¶å˜æ¢ï¼Œåˆ©ç”¨æ­¤ä¸€æ€§è´¨ï¼Œèƒ½ç®€åŒ–å‚…é‡Œå¶åˆ†æä¸­çš„è®¸å¤šé—®é¢˜ã€‚

> operation è§†è¯­å¢ƒæœ‰æ—¶è¯‘ä½œâ€œæ“ä½œâ€ï¼Œæœ‰æ—¶è¯‘ä½œâ€œè¿ç®—â€ï¼Œæœ¬æ–‡ä¸åšåŒºåˆ†ã€‚

### 1.1ï¼Œå·ç§¯è¿ç®—å®šä¹‰

ä¸ºäº†ç»™å‡ºå·ç§¯çš„å®šä¹‰ï¼Œ è¿™é‡Œä»ç°å®ä¸–ç•Œä¼šç”¨åˆ°å‡½æ•°çš„ä¾‹å­å‡ºå‘ã€‚

å‡è®¾æˆ‘ä»¬æ­£åœ¨ç”¨æ¿€å…‰ä¼ æ„Ÿå™¨è¿½è¸ªä¸€è‰˜å®‡å®™é£èˆ¹çš„ä½ç½®ã€‚æˆ‘ä»¬çš„æ¿€å…‰ä¼ æ„Ÿå™¨ç»™å‡º ä¸€ä¸ªå•ç‹¬çš„è¾“å‡º $x(t)$ï¼Œè¡¨ç¤ºå®‡å®™é£èˆ¹åœ¨æ—¶åˆ» $t$ çš„ä½ç½®ã€‚$x$ å’Œ  $t$ éƒ½æ˜¯**å®å€¼**çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»ä»ä¼ æ„Ÿå™¨ä¸­è¯»å‡ºé£èˆ¹çš„ä½ç½®ã€‚

ç°åœ¨å‡è®¾æˆ‘ä»¬çš„ä¼ æ„Ÿå™¨å—åˆ°ä¸€å®šç¨‹åº¦çš„å™ªå£°å¹²æ‰°ã€‚ä¸ºäº†å¾—åˆ°é£èˆ¹ä½ç½®çš„ä½å™ªå£°ä¼°è®¡ï¼Œæˆ‘ä»¬å¯¹å¾—åˆ°çš„æµ‹é‡ç»“æœè¿›è¡Œå¹³å‡ã€‚æ˜¾ç„¶ï¼Œæ—¶é—´ä¸Šè¶Šè¿‘çš„æµ‹é‡ç»“æœè¶Šç›¸å…³ï¼Œæ‰€ ä»¥æˆ‘ä»¬é‡‡ç”¨ä¸€ç§**åŠ æƒå¹³å‡**çš„æ–¹æ³•ï¼Œå¯¹äºæœ€è¿‘çš„æµ‹é‡ç»“æœèµ‹äºˆæ›´é«˜çš„æƒé‡ã€‚æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸€ä¸ªåŠ æƒå‡½æ•° $w(a)$ æ¥å®ç°ï¼Œå…¶ä¸­ $a$ è¡¨ç¤ºæµ‹é‡ç»“æœè·å½“å‰æ—¶åˆ»çš„æ—¶é—´é—´éš”ã€‚å¦‚æœæˆ‘ä»¬å¯¹ä»»æ„æ—¶åˆ»éƒ½é‡‡ç”¨è¿™ç§åŠ æƒå¹³å‡çš„æ“ä½œï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªæ–°çš„å¯¹äºé£èˆ¹ä½ç½®çš„å¹³æ»‘ä¼°è®¡å‡½æ•° $s$ :
$$
s(t) = \int x(a)w(t-a )da
$$
è¿™ç§è¿ç®—å°±å«åšå·ç§¯ï¼ˆ`convolution`ï¼‰ã€‚æ›´ä¸€èˆ¬çš„ï¼Œå·ç§¯è¿ç®—çš„æ•°å­¦å…¬å¼å®šä¹‰å¦‚ä¸‹ï¼š
$$
è¿ç»­å®šä¹‰: \; h(x)=(f*g)(x) = \int_{-\infty}^{\infty} f(t)g(x-t)dt \tag{1}
$$

$$
ç¦»æ•£å®šä¹‰: \; h(x) = (f*g)(x) = \sum^{\infty}_{t=-\infty} f(t)g(x-t) \tag{2}
$$

ä»¥ä¸Šå·ç§¯è®¡ç®—å…¬å¼å¯ä»¥è¿™æ ·ç†è§£:

1. å…ˆå¯¹å‡½æ•° $g(t)$ è¿›è¡Œåè½¬ï¼ˆ`reverse`ï¼‰ï¼Œç›¸å½“äºåœ¨æ•°è½´ä¸ŠæŠŠ $g(t)$ å‡½æ•°ä»å³è¾¹è¤¶åˆ°å·¦è¾¹å»ï¼Œä¹Ÿå°±æ˜¯å·ç§¯çš„â€œå·â€çš„ç”±æ¥ã€‚
2. ç„¶åå†æŠŠ $g(t)$ å‡½æ•°å‘å·¦å¹³ç§» $x$ ä¸ªå•ä½ï¼Œåœ¨è¿™ä¸ªä½ç½®å¯¹ä¸¤ä¸ªå‡½æ•°çš„å¯¹åº”ç‚¹ç›¸ä¹˜ï¼Œç„¶åç›¸åŠ ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å·ç§¯çš„â€œç§¯â€çš„è¿‡ç¨‹ã€‚

### 1.2ï¼Œå·ç§¯çš„æ„ä¹‰

å¯¹å·ç§¯è¿™ä¸ªåè¯ï¼Œå¯ä»¥è¿™æ ·ç†è§£ï¼š**æ‰€è°“ä¸¤ä¸ªå‡½æ•°çš„å·ç§¯ï¼ˆ$f*g$ï¼‰ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å…ˆå°†ä¸€ä¸ªå‡½æ•°ç¿»è½¬ï¼Œç„¶åè¿›è¡Œæ»‘åŠ¨å åŠ **ã€‚åœ¨è¿ç»­æƒ…å†µä¸‹ï¼Œå åŠ æŒ‡çš„æ˜¯å¯¹ä¸¤ä¸ªå‡½æ•°çš„ä¹˜ç§¯æ±‚ç§¯åˆ†ï¼Œåœ¨ç¦»æ•£æƒ…å†µä¸‹å°±æ˜¯åŠ æƒæ±‚å’Œï¼Œä¸ºç®€å•èµ·è§å°±ç»Ÿä¸€ç§°ä¸ºå åŠ ã€‚

å› æ­¤ï¼Œå·ç§¯è¿ç®—æ•´ä½“æ¥çœ‹å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹:

ç¿»è½¬â€”>æ»‘åŠ¨â€”>å åŠ â€”>æ»‘åŠ¨â€”>å åŠ â€”>æ»‘åŠ¨â€”>å åŠ .....

å¤šæ¬¡æ»‘åŠ¨å¾—åˆ°çš„ä¸€ç³»åˆ—å åŠ å€¼ï¼Œæ„æˆäº†å·ç§¯å‡½æ•°ã€‚

> è¿™é‡Œå¤šæ¬¡æ»‘åŠ¨è¿‡ç¨‹å¯¹åº”çš„æ˜¯ $t$ çš„å˜åŒ–è¿‡ç¨‹ã€‚

é‚£ä¹ˆï¼Œ**å·ç§¯çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢**ï¼Ÿå¯ä»¥ä»å·ç§¯çš„å…¸å‹åº”ç”¨åœºæ™¯-å›¾åƒå¤„ç†æ¥ç†è§£ï¼š

1. ä¸ºä»€ä¹ˆè¦è¿›è¡Œâ€œå·â€ï¼Ÿè¿›è¡Œâ€œå·â€ï¼ˆç¿»è½¬ï¼‰çš„ç›®çš„å…¶å®æ˜¯æ–½åŠ ä¸€ç§çº¦æŸï¼Œå®ƒæŒ‡å®šäº†åœ¨â€œç§¯â€çš„æ—¶å€™ä»¥ä»€ä¹ˆä¸ºå‚ç…§ã€‚åœ¨ç©ºé—´åˆ†æçš„åœºæ™¯ï¼Œå®ƒæŒ‡å®šäº†åœ¨å“ªä¸ªä½ç½®çš„å‘¨è¾¹è¿›è¡Œç´¯ç§¯å¤„ç†ã€‚
2. åœ¨å›¾åƒå¤„ç†çš„ä¸­ï¼Œå·ç§¯å¤„ç†çš„ç»“æœï¼Œå…¶å®å°±æ˜¯æŠŠæ¯ä¸ªåƒç´ å‘¨è¾¹çš„ï¼Œç”šè‡³æ˜¯æ•´ä¸ªå›¾åƒçš„åƒç´ éƒ½è€ƒè™‘è¿›æ¥ï¼Œå¯¹å½“å‰åƒç´ è¿›è¡ŒæŸç§åŠ æƒå¤„ç†ã€‚å› æ­¤ï¼Œâ€œç§¯â€æ˜¯å…¨å±€æ¦‚å¿µï¼Œæˆ–è€…è¯´æ˜¯ä¸€ç§â€œæ··åˆâ€ï¼ŒæŠŠä¸¤ä¸ªå‡½æ•°è¿›è¡Œæ—¶é—´ï¼ˆä¿¡å·åˆ†æï¼‰æˆ–ç©ºé—´ï¼ˆå›¾åƒå¤„ç†ï¼‰ä¸Šè¿›è¡Œæ··åˆã€‚

> å·ç§¯æ„ä¹‰çš„ç†è§£æ¥è‡ª[çŸ¥ä¹é—®ç­”](https://www.zhihu.com/question/22298352)ï¼Œæœ‰æ‰€åˆ å‡å’Œä¼˜åŒ–ã€‚

### 1.3ï¼Œä»å®ä¾‹ç†è§£å·ç§¯

ä¸€ç»´å·ç§¯çš„å®ä¾‹æœ‰ â€œä¸¢éª°å­â€ ç­‰ç»å…¸å®ä¾‹ï¼Œè¿™é‡Œä¸åšå±•å¼€æè¿°ï¼Œæœ¬æ–‡ä»äºŒç»´å·ç§¯ç”¨äºå›¾åƒå¤„ç†çš„å®ä¾‹æ¥ç†è§£ã€‚

ä¸€èˆ¬ï¼Œæ•°å­—å›¾åƒå¯ä»¥è¡¨ç¤ºä¸ºå¦‚ä¸‹æ‰€ç¤ºçŸ©é˜µï¼š

> æœ¬èŠ‚å›¾ç‰‡æ‘˜è‡ª[çŸ¥ä¹ç”¨æˆ·é©¬åŒå­¦çš„æ–‡ç« ](https://www.zhihu.com/question/22298352)ã€‚

![å›¾åƒçŸ©é˜µ](../images/conv/image1.png)

è€Œå·ç§¯æ ¸ $g$ ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªçŸ©é˜µæ¥è¡¨ç¤ºï¼Œå¦‚:
$$
g = \begin{bmatrix} 
&b_{-1,-1} &b_{-1,0} &b_{-1,1} \\ 
&b_{0,-1} &b_{0,0} &b_{0,1} \\ 
&b_{1,-1} &b_{1,0} &b_{1,1}
\end{bmatrix}
$$
æŒ‰ç…§å·ç§¯å…¬å¼çš„å®šä¹‰ï¼Œåˆ™ç›®æ ‡å›¾ç‰‡çš„ç¬¬ $(u, v)$ ä¸ªåƒç´ çš„äºŒç»´å·ç§¯å€¼ä¸ºï¼š
$$
(f * g)(u, v)=\sum_{i} \sum_{j} f(i, j)g(u-i, v-j)=\sum_{i} \sum_{j} a_{i,j} b_{u-i,v-j}
$$
å±•å¼€æ¥åˆ†æäºŒç»´å·ç§¯è®¡ç®—è¿‡ç¨‹å°±æ˜¯ï¼Œé¦–å…ˆå¾—åˆ°åŸå§‹å›¾åƒçŸ©é˜µä¸­ $(u, v)$ å¤„çš„çŸ©é˜µï¼š
$$
f=\begin{bmatrix} 
&a_{u-1,v-1} &a_{u-1,v} &a_{u-1,v+1}\\ 
&a_{u,v-1} &a_{u,v} &a_{u,v+1} \\ 
&a_{u+1,v-1} &a_{u+1,v} &a_{u+1,v+1}
\end{bmatrix}
$$
ç„¶åå°†å›¾åƒå¤„ç†çŸ©é˜µ**ç¿»è½¬**ï¼ˆä¸¤ç§æ–¹æ³•ï¼Œç»“æœç­‰æ•ˆï¼‰ï¼Œå¦‚å…ˆæ²¿ $x$ è½´ç¿»è½¬ï¼Œå†æ²¿ $y$ è½´ç¿»è½¬ï¼ˆ**ç›¸å½“äºå°†çŸ©é˜µ $g$ æ—‹è½¬ 180 åº¦**ï¼‰ï¼š
$$
\begin{aligned}
g &= \begin{bmatrix} &b_{-1,-1} &b_{-1,0} &b_{-1,1}\\ &b_{0,-1} &b_{0,0} &b_{0,1} \\ &b_{1,-1} &b_{1,0} &b_{1,1} \end{bmatrix} => \begin{bmatrix} &b_{1,-1} &b_{1,0} &b_{1,1}\\ &b_{0,-1} &b_{0,0} &b_{0,1} \\ &b_{-1,-1} &b_{-1,0} &b_{-1,1} \end{bmatrix} \\
&= \begin{bmatrix} &b_{1,1} &b_{1,0} &b_{1,-1}\\ &b_{0,1} &b_{0,0} &b_{0,-1} \\ &b_{-1,1} &b_{-1,0} &b_{-1,-1} \end{bmatrix} = g^{'}
\end{aligned}
$$
æœ€åï¼Œè®¡ç®—å·ç§¯æ—¶ï¼Œå°±å¯ä»¥ç”¨ $f$ å’Œ $gâ€²$ çš„å†…ç§¯ï¼š
$$
\begin{aligned}
f * g(u,v) &= a_{u-1,v-1} \times b_{1,1} + a_{u-1,v} \times b_{1,0} + a_{u-1,v+1} \times b_{1,-1} \\ &+ a_{u,v-1} \times b_{0,1} + a_{u,v} \times b_{0,0} + a_{u,v+1} \times b_{0,-1} \\ &+ a_{u+1,v-1} \times b_{-1,1} + a_{u+1,v} \times b_{-1,0} + a_{u+1,v+1} \times b_{-1,-1}
\end{aligned}
$$

è®¡ç®—è¿‡ç¨‹å¯è§†åŒ–å¦‚ä¸‹åŠ¨å›¾æ‰€ç¤ºï¼Œæ³¨æ„åŠ¨å›¾ç»™å‡ºçš„æ˜¯ $g$ ä¸æ˜¯ $g'$ã€‚

![äºŒç»´å·ç§¯è®¡ç®—è¿‡ç¨‹](../images/conv/conv_visual.gif)

ä»¥ä¸Šå…¬å¼æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œåšä¹˜æ³•çš„ä¸¤ä¸ªå¯¹åº”å˜é‡ $a, b$ çš„ä¸‹æ ‡ä¹‹å’Œéƒ½æ˜¯ $(u,v)$ï¼Œå…¶ç›®çš„æ˜¯å¯¹è¿™ç§åŠ æƒæ±‚å’Œè¿›è¡Œä¸€ç§çº¦æŸï¼Œè¿™ä¹Ÿæ˜¯è¦å°†çŸ©é˜µ $g$ è¿›è¡Œç¿»è½¬çš„åŸå› ã€‚ä¸Šè¿°è®¡ç®—æ¯”è¾ƒéº»çƒ¦ï¼Œå®é™…è®¡ç®—çš„æ—¶å€™ï¼Œéƒ½æ˜¯ç”¨ç¿»è½¬ä»¥åçš„çŸ©é˜µï¼Œç›´æ¥æ±‚**çŸ©é˜µå†…ç§¯**å°±å¯ä»¥äº†ã€‚

### 1.4ï¼Œå›¾åƒå·ç§¯ï¼ˆäºŒç»´å·ç§¯ï¼‰

åœ¨æœºå™¨å­¦ä¹ å’Œå›¾åƒå¤„ç†é¢†åŸŸï¼Œå·ç§¯çš„ä¸»è¦åŠŸèƒ½æ˜¯**åœ¨ä¸€ä¸ªå›¾åƒ(æˆ–æŸç§ç‰¹å¾) ä¸Šæ»‘åŠ¨ä¸€ä¸ªå·ç§¯æ ¸(å³æ»¤æ³¢å™¨)ï¼Œé€šè¿‡å·ç§¯æ“ä½œå¾—åˆ°ä¸€ç»„æ–°çš„ç‰¹å¾**ã€‚ä¸€å¹…å›¾åƒåœ¨ç»è¿‡å·ç§¯æ“ä½œåå¾—åˆ°ç»“æœç§°ä¸ºç‰¹å¾æ˜ å°„(`Feature Map`)ã€‚å¦‚æœæŠŠå›¾åƒçŸ©é˜µç®€å†™ä¸º $I$ï¼ŒæŠŠå·ç§¯æ ¸ `Kernal` ç®€å†™ä¸º $K$ï¼Œåˆ™ç›®æ ‡å›¾ç‰‡çš„ç¬¬ $(i,j)$ ä¸ªåƒç´ çš„å·ç§¯å€¼ä¸ºï¼š
$$
h(i,j) = (I*K)(i,j)=\sum_m \sum_n I(m,n)K(i-m,j-n) \tag{3}
$$
å¯ä»¥çœ‹å‡ºï¼Œè¿™å’Œä¸€ç»´æƒ…å†µä¸‹çš„å·ç§¯å…¬å¼ 2 æ˜¯ä¸€è‡´çš„ã€‚å› ä¸ºå·ç§¯çš„å¯äº¤æ¢æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå…¬å¼ 3 ç­‰ä»·åœ°å†™ä½œï¼š
$$
h(i,j) = (I*K)(i,j)=\sum_m \sum_n I(i-m,j-n)K(m,n) \tag{4}
$$
é€šå¸¸ï¼Œä¸‹é¢çš„å…¬å¼åœ¨æœºå™¨å­¦ä¹ åº“ä¸­å®ç°æ›´ä¸ºç®€å•ï¼Œå› ä¸º $m$ å’Œ $n$ çš„æœ‰æ•ˆå–å€¼èŒƒå›´ç›¸å¯¹è¾ƒå°ã€‚

å·ç§¯è¿ç®—å¯äº¤æ¢æ€§çš„å‡ºç°æ˜¯å› ä¸ºæˆ‘ä»¬å°†æ ¸ç›¸å¯¹è¾“å…¥è¿›è¡Œäº†ç¿»è½¬ï¼ˆ`flip`ï¼‰ï¼Œä» $m$ å¢ å¤§çš„è§’åº¦æ¥çœ‹ï¼Œè¾“å…¥çš„ç´¢å¼•åœ¨å¢å¤§ï¼Œä½†æ˜¯å·ç§¯æ ¸çš„ç´¢å¼•åœ¨å‡å°ã€‚æˆ‘ä»¬å°†**å·ç§¯æ ¸ç¿»è½¬çš„å”¯ä¸€ç›® çš„æ˜¯å®ç°å¯äº¤æ¢æ€§**ã€‚å°½ç®¡å¯äº¤æ¢æ€§åœ¨è¯æ˜æ—¶å¾ˆæœ‰ç”¨ï¼Œä½†åœ¨ç¥ç»ç½‘ç»œçš„åº”ç”¨ä¸­å´ä¸æ˜¯ä¸€ä¸ªé‡è¦çš„æ€§è´¨ã€‚ç›¸åï¼Œè®¸å¤šç¥ç»ç½‘ç»œåº“ä¼šå®ç°ä¸€ä¸ª**äº’ç›¸å…³å‡½æ•°**ï¼ˆ`corresponding function`ï¼‰ï¼Œå®ƒä¸å·ç§¯ç›¸åŒä½†æ²¡æœ‰ç¿»è½¬æ ¸ï¼š
$$
h(i,j) = (I*K)(i,j)=\sum_m \sum_n I(i+m,j+n)K(m,n) \tag{5}
$$

äº’ç›¸å…³å‡½æ•°çš„è¿ç®—ï¼Œæ˜¯ä¸¤ä¸ªåºåˆ—æ»‘åŠ¨ç›¸ä¹˜ï¼Œä¸¤ä¸ªåºåˆ—éƒ½ä¸ç¿»è½¬ã€‚å·ç§¯è¿ç®—ä¹Ÿæ˜¯æ»‘åŠ¨ç›¸ä¹˜ï¼Œä½†æ˜¯å…¶ä¸­ä¸€ä¸ªåºåˆ—éœ€è¦å…ˆç¿»è½¬ï¼Œå†ç›¸ä¹˜ã€‚

### 1.5ï¼Œäº’ç›¸å…³å’Œå·ç§¯

äº’ç›¸å…³å’Œå·ç§¯è¿ç®—çš„å…³ç³»ï¼Œå¯ä»¥é€šè¿‡ä¸‹è¿°å…¬å¼ç†è§£ï¼š
$$
\begin{aligned}
Y &= W\otimes X \\
  &= \text{rot180}(W) * X
\end{aligned}
$$
å…¶ä¸­ $\otimes$ è¡¨ç¤ºäº’ç›¸å…³è¿ç®—ï¼Œ$*$ è¡¨ç¤ºå·ç§¯è¿ç®—ï¼Œ$\text{rot180(â‹…)}$ è¡¨ç¤ºæ—‹è½¬ `180` åº¦ï¼Œ$Y$ ä¸ºè¾“å‡ºçŸ©é˜µã€‚ä»ä¸Šå¼å¯ä»¥çœ‹å‡ºï¼Œäº’ç›¸å…³å’Œå·ç§¯çš„åŒºåˆ«ä»…ä»…åœ¨äºå·ç§¯æ ¸æ˜¯å¦è¿›è¡Œç¿»è½¬ã€‚å› æ­¤äº’ç›¸å…³ä¹Ÿå¯ä»¥ç§°ä¸ºä¸ç¿»è½¬å·ç§¯.
> ç¦»æ•£å·ç§¯å¯ä»¥çœ‹ä½œçŸ©é˜µçš„ä¹˜æ³•ï¼Œç„¶è€Œï¼Œè¿™ä¸ªçŸ©é˜µçš„ä¸€äº›å…ƒç´ è¢«é™åˆ¶ä¸ºå¿…é¡»å’Œå¦å¤–ä¸€äº›å…ƒç´ ç›¸ç­‰ã€‚

åœ¨ç¥ç»ç½‘ç»œä¸­ä½¿ç”¨å·ç§¯æ˜¯ä¸ºäº†è¿›è¡Œç‰¹å¾æŠ½å–ï¼Œ**å·ç§¯æ ¸æ˜¯å¦è¿›è¡Œç¿»è½¬å’Œå…¶ç‰¹å¾æŠ½å–çš„èƒ½åŠ›æ— å…³**ï¼ˆç‰¹åˆ«æ˜¯å½“å·ç§¯æ ¸æ˜¯å¯å­¦ä¹ çš„å‚æ•°æ—¶ï¼‰ï¼Œ**å› æ­¤å·ç§¯å’Œäº’ç›¸å…³åœ¨èƒ½åŠ›ä¸Šæ˜¯ç­‰ä»·çš„**ã€‚äº‹å®ä¸Šï¼Œå¾ˆå¤šæ·±åº¦å­¦ä¹ å·¥å…·ä¸­å·ç§¯æ“ä½œå…¶å®éƒ½æ˜¯äº’ç›¸å…³æ“ä½œï¼Œç”¨æ¥**å‡å°‘ä¸€äº›ä¸å¿…è¦çš„æ“ä½œæˆ–å¼€é”€ï¼ˆä¸åè½¬ Kernalï¼‰**ã€‚

æ€»çš„æ¥è¯´ï¼Œ
1. æˆ‘ä»¬å®ç°çš„å·ç§¯æ“ä½œä¸æ˜¯åŸå§‹æ•°å­¦å«ä¹‰çš„å·ç§¯ï¼Œè€Œæ˜¯å·¥ç¨‹ä¸Šçš„å·ç§¯ï¼Œä½†ä¸€èˆ¬ä¹Ÿç®€ç§°ä¸ºå·ç§¯ã€‚
2. åœ¨å®ç°å·ç§¯æ“ä½œæ—¶ï¼Œå¹¶ä¸ä¼šåè½¬å·ç§¯æ ¸ã€‚

## äºŒï¼Œå·ç§¯å±‚

> åœ¨ä¼ ç»Ÿå›¾åƒå¤„ç†ä¸­ï¼Œ**çº¿æ€§ç©ºé—´æ»¤æ³¢**çš„åŸç†å®è´¨ä¸Šæ˜¯æŒ‡æŒ‡å›¾åƒ $f$ ä¸æ»¤æ³¢å™¨æ ¸ $w$ è¿›è¡Œä¹˜ç§¯ä¹‹å’Œï¼ˆ**å·ç§¯**ï¼‰è¿ç®—ã€‚æ ¸æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œå…¶å¤§å°å®šä¹‰äº†è¿ç®—çš„é‚»åŸŸï¼Œå…¶ç³»æ•°å†³å®šäº†è¯¥æ»¤æ³¢å™¨ï¼ˆä¹Ÿç§°æ¨¡æ¿ã€çª—å£æ»¤æ³¢å™¨ï¼‰çš„æ€§è´¨ï¼Œå¹¶é€šè¿‡è®¾è®¡ä¸åŒæ ¸ç³»æ•°ï¼ˆå·ç§¯æ ¸ï¼‰æ¥å®ç°ä½é€šæ»¤æ³¢ï¼ˆå¹³æ»‘ï¼‰å’Œé«˜é€šæ»¤æ³¢ï¼ˆé”åŒ–ï¼‰åŠŸèƒ½ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå·ç§¯æ˜¯åˆ©ç”¨æŸäº›è®¾è®¡å¥½çš„å‚æ•°ç»„åˆï¼ˆå·ç§¯æ ¸ï¼‰å»æå–å›¾åƒç©ºåŸŸä¸Šç›¸é‚»çš„ä¿¡æ¯ã€‚

### 2.1ï¼Œå·ç§¯å±‚å®šä¹‰

åœ¨å…¨è¿æ¥å‰é¦ˆç¥ç»ç½‘ç»œä¸­ï¼Œå¦‚æœç¬¬ $l$ å±‚æœ‰ $M_l$ ä¸ªç¥ç»å…ƒï¼Œç¬¬ $l-1$ å±‚æœ‰ $M_{l-1}$  ä¸ª ç¥ç»å…ƒï¼Œè¿æ¥è¾¹æœ‰ $M_{l}\times M_{l-1}$ ä¸ªï¼Œä¹Ÿå°±æ˜¯æƒé‡çŸ©é˜µæœ‰ $M_{l}\times M_{l-1}$  ä¸ªå‚æ•°ã€‚å½“ $M_l$ å’Œ $M_{l-1}$ éƒ½å¾ˆå¤§æ—¶ï¼Œæƒé‡çŸ©é˜µçš„å‚æ•°å°±ä¼šéå¸¸å¤šï¼Œè®­ç»ƒçš„æ•ˆç‡ä¹Ÿä¼šéå¸¸ä½ã€‚

å¦‚æœé‡‡ç”¨å·ç§¯æ¥ä»£æ›¿å…¨è¿æ¥ï¼Œç¬¬ $l$ å±‚çš„å‡€è¾“å…¥ $z^{(l)}$ ä¸ºç¬¬ $l-1$ å±‚æ¿€æ´»å€¼ $a^{(lâˆ’1)}$ å’Œå·ç§¯æ ¸ $w^{(l)}\in \mathbb{R}^K$ çš„å·ç§¯ï¼Œå³
$$
z^{(l)} = w^{(l)}\otimes a^{(lâˆ’1)} + b^{(l)}
$$
å…¶ä¸­ $b^{(l)}\in \mathbb{R}$ ä¸ºå¯å­¦ä¹ çš„åç½®ã€‚

> ä¸Šè¿°å·ç§¯å±‚å…¬å¼ä¹Ÿå¯ä»¥å†™æˆè¿™æ ·çš„å½¢å¼ï¼š$Z = W*A+b$

æ ¹æ®å·ç§¯å±‚çš„å®šä¹‰ï¼Œå·ç§¯å±‚æœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„æ€§è´¨:

1. **å±€éƒ¨è¿æ¥**ï¼šåœ¨å·ç§¯å±‚(å‡è®¾æ˜¯ç¬¬ $l$ å±‚)ä¸­çš„æ¯ä¸€ä¸ªç¥ç»å…ƒéƒ½åªå’Œä¸‹ä¸€å±‚(ç¬¬ $l âˆ’ 1$ å±‚)ä¸­æŸä¸ªå±€éƒ¨çª—å£å†…çš„ç¥ç»å…ƒç›¸è¿ï¼Œæ„æˆä¸€ä¸ªå±€éƒ¨è¿æ¥ç½‘ç»œã€‚
2. **æƒé‡å…±äº«**ï¼šä½œä¸ºå‚æ•°çš„å·ç§¯æ ¸ $w^{(ğ‘™)}$ å¯¹äºç¬¬ $l$ å±‚çš„æ‰€æœ‰çš„ç¥ç»å…ƒéƒ½æ˜¯ç›¸åŒçš„ã€‚æƒé‡å…±äº«å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå·ç§¯æ ¸åªæ•æ‰è¾“å…¥æ•°æ®ä¸­çš„ä¸€ç§ç‰¹å®šçš„å±€éƒ¨ç‰¹å¾.å› æ­¤ï¼Œå¦‚æœè¦æå–å¤šç§ç‰¹å¾å°±éœ€è¦ä½¿ç”¨å¤šä¸ªä¸åŒçš„å·ç§¯æ ¸ã€‚

![å…¨è¿æ¥å±‚å’Œå·ç§¯å±‚å¯¹æ¯”](../images/conv/ful_conv.png)

æ€»è€Œè¨€ä¹‹ï¼Œå·ç§¯å±‚çš„ä½œç”¨æ˜¯æå–ä¸€ä¸ªå±€éƒ¨åŒºåŸŸçš„ç‰¹å¾ï¼Œä¸åŒçš„å·ç§¯æ ¸ï¼ˆæ»¤æ³¢å™¨ï¼‰ç›¸å½“äºä¸åŒçš„ç‰¹å¾æå–å™¨ã€‚ä¸ºäº†æé«˜å·ç§¯ç½‘ç»œçš„è¡¨ç¤ºèƒ½åŠ›ï¼Œå¯ä»¥åœ¨æ¯ä¸€å±‚ä½¿ç”¨å¤šä¸ªä¸åŒçš„ç‰¹å¾æ˜ å°„ï¼Œå³å¢åŠ å·ç§¯æ ¸ï¼ˆæ»¤æ³¢å™¨ï¼‰çš„æ•°é‡ï¼Œä»¥æ›´å¥½åœ°æå–å›¾åƒçš„ç‰¹å¾ã€‚

### 2.2ï¼Œå·ç§¯å±‚ç†è§£

å‰é¢ç« èŠ‚å†…å®¹ä¸­ï¼Œå·ç§¯çš„è¾“å‡ºå½¢çŠ¶åªå–å†³äºè¾“å…¥å½¢çŠ¶å’Œå·ç§¯æ ¸çš„å½¢çŠ¶ã€‚è€Œç¥ç»ç½‘ç»œä¸­çš„å·ç§¯å±‚ï¼Œåœ¨å·ç§¯çš„æ ‡å‡†å®šä¹‰åŸºç¡€ä¸Šï¼Œè¿˜å¼•å…¥äº†å·ç§¯æ ¸çš„æ»‘åŠ¨æ­¥é•¿å’Œé›¶å¡«å……æ¥å¢åŠ å·ç§¯çš„å¤šæ ·æ€§ï¼Œä»è€Œå¯ä»¥æ›´çµæ´»åœ°è¿›è¡Œç‰¹å¾æŠ½å–ã€‚

- æ­¥é•¿(Stride)ï¼šæŒ‡å·ç§¯æ ¸æ¯æ¬¡æ»‘åŠ¨çš„è·ç¦»
- é›¶å¡«å……(Zero Padding)ï¼šåœ¨è¾“å…¥å›¾åƒçš„è¾¹ç•Œå¡«å……å…ƒç´ (é€šå¸¸å¡«å……å…ƒç´ æ˜¯0)

å·ç§¯å±‚å®šä¹‰ï¼šæ¯ä¸ªå·ç§¯æ ¸ï¼ˆ`Kernel`ï¼‰åœ¨è¾“å…¥çŸ©é˜µä¸Šæ»‘åŠ¨ï¼Œå¹¶é€šè¿‡ä¸‹è¿°è¿‡ç¨‹å®ç°å·ç§¯è®¡ç®—:

1. åœ¨æ¥è‡ªå·ç§¯æ ¸çš„å…ƒç´ å’Œè¾“å…¥ç‰¹å¾å›¾å­çŸ©é˜µçš„å…ƒç´ ä¹‹é—´è¿›è¡Œä¹˜æ³•ä»¥è·å¾—è¾“å‡ºæ„Ÿå—é‡ã€‚ 
2. ç„¶åå°†ç›¸ä¹˜çš„å€¼ä¸æ·»åŠ çš„åå·®ç›¸åŠ ä»¥è·å¾—è¾“å‡ºçŸ©é˜µä¸­çš„å€¼ã€‚ 

å·ç§¯å±‚æ•°å€¼è®¡ç®—è¿‡ç¨‹å¯è§†åŒ–å¦‚ä¸‹å›¾  1 æ‰€ç¤ºï¼š

![Example of Convolutional layer](../images/conv/Example-of-Convolutional-layer.pbm)

> æ¥æºè®ºæ–‡ [Improvement of Damage Segmentation Based on Pixel-Level Data Balance Using VGG-Unet](https://www.researchgate.net/figure/Example-of-Convolutional-layer_fig2_348296106)ã€‚

æ³¨æ„ï¼Œå·ç§¯å±‚çš„è¾“å‡º `Feature map` çš„å¤§å°å–å†³äºè¾“å…¥çš„å¤§å°ã€Pad æ•°ã€å·ç§¯æ ¸å¤§å°å’Œæ­¥é•¿ã€‚åœ¨ `Pytorch` æ¡†æ¶ä¸­ï¼Œå›¾ç‰‡ï¼ˆ`feature map`ï¼‰ç»å·ç§¯ `Conv2D` å**è¾“å‡ºå¤§å°è®¡ç®—å…¬å¼**å¦‚ä¸‹ï¼š$\left \lfloor N = \frac{W-F+2P}{S}+1 \right \rfloor$ã€‚

å…¶ä¸­ $\lfloor \rfloor$ æ˜¯å‘ä¸‹å–æ•´ç¬¦å·ï¼Œç”¨äºç»“æœä¸æ˜¯æ•´æ•°æ—¶è¿›è¡Œå‘ä¸‹å–æ•´ï¼ˆ`Pytorch` çš„ `Conv2d` å·ç§¯å‡½æ•°çš„é»˜è®¤å‚æ•° `ceil_mode = False`ï¼Œå³é»˜è®¤å‘ä¸‹å–æ•´, `dilation = 1`ï¼‰ï¼Œå…¶ä»–ç¬¦å·è§£é‡Šå¦‚ä¸‹ï¼š

+ è¾“å…¥å›¾ç‰‡å¤§å° `WÃ—W`ï¼ˆé»˜è®¤è¾“å…¥å°ºå¯¸ä¸ºæ­£æ–¹å½¢ï¼‰
+ `Filter` å¤§å° `FÃ—F`
+ æ­¥é•¿ `S`
+ paddingçš„åƒç´ æ•° `P`
+ è¾“å‡ºç‰¹å¾å›¾å¤§å° `NÃ—N`

ä¸Šå›¾1ä¾§é‡äºè§£é‡Šæ•°å€¼è®¡ç®—è¿‡ç¨‹ï¼Œè€Œä¸‹å›¾2åˆ™ä¾§é‡äºè§£é‡Šå·ç§¯å±‚çš„äº”ä¸ªæ ¸å¿ƒæ¦‚å¿µçš„å…³ç³»ï¼š

- è¾“å…¥ Input Channel
- å·ç§¯æ ¸ç»„ WeightsBias
- è¿‡æ»¤å™¨ Filter
- å·ç§¯æ ¸ kernal
- è¾“å‡º Feature Map

![ä¸‰é€šé“ç»è¿‡ä¸¤ç»„è¿‡æ»¤å™¨çš„å·ç§¯è¿‡ç¨‹](../images/conv/conv3d.png)

ä¸Šå›¾æ˜¯ä¸‰é€šé“ç»è¿‡ä¸¤ç»„è¿‡æ»¤å™¨çš„å·ç§¯è¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¾“å…¥æ˜¯ä¸‰ç»´æ•°æ® $3\times 32 \times32$ï¼Œç»è¿‡æƒé‡å‚æ•°å°ºå¯¸ä¸º $2\times 3\times 5\times 5$ çš„å·ç§¯å±‚åï¼Œè¾“å‡ºä¸ºä¸‰ç»´ $2\times 28\times 28$ï¼Œç»´æ•°å¹¶æ²¡æœ‰å˜åŒ–ï¼Œåªæ˜¯æ¯ä¸€ç»´å†…éƒ¨çš„å°ºå¯¸æœ‰äº†å˜åŒ–ï¼Œä¸€èˆ¬éƒ½æ˜¯è¦å‘æ›´å°çš„å°ºå¯¸å˜åŒ–ï¼Œä»¥ä¾¿äºç®€åŒ–è®¡ç®—ã€‚

å‡è®¾ä¸‰ç»´å·ç§¯ï¼ˆä¹Ÿå«æ»¤æ³¢å™¨ï¼‰å°ºå¯¸ä¸º $(c_{in}, k, k)$ï¼Œä¸€å…±æœ‰ $c_{out}$ ä¸ªæ»¤æ³¢å™¨ï¼Œå³å·ç§¯å±‚å‚æ•°å°ºå¯¸ä¸º $(c_{out}, c_{in}, k, k)$ ï¼Œåˆ™æ ‡å‡†å·ç§¯å±‚æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. è¾“å‡ºçš„ `feature map` çš„æ•°é‡ç­‰äºæ»¤æ³¢å™¨æ•°é‡ $c_{out}$ï¼Œå³å·ç§¯å±‚å‚æ•°å€¼ç¡®å®šåï¼Œfeature map çš„æ•°é‡ä¹Ÿç¡®å®šï¼Œè€Œä¸æ˜¯æ ¹æ®å‰å‘è®¡ç®—è‡ªåŠ¨è®¡ç®—å‡ºæ¥ï¼›
2. å¯¹äºæ¯ä¸ªè¾“å‡ºï¼Œéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„è¿‡æ»¤å™¨ Filterï¼Œå›¾ä¾‹ä¸­ Feature Map-1 å¯¹åº” Filter-1ï¼›
3. æ¯ä¸ª Filter å†…éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå·ç§¯æ ¸ Kernalï¼Œå¯¹åº”æ¯ä¸ªè¾“å…¥é€šé“(Input Channel)ï¼Œå›¾ä¾‹ä¸º 3ï¼Œå¯¹åº”è¾“å…¥çš„çº¢ç»¿è“ä¸‰ä¸ªé€šé“ï¼›
4. æ¯ä¸ª Filter åªæœ‰ä¸€ä¸ª Bias å€¼ï¼Œå›¾ä¾‹ä¸­ Filter-1 å¯¹åº” b1ï¼›
5. å·ç§¯æ ¸ Kernal çš„å¤§å°ä¸€èˆ¬æ˜¯å¥‡æ•°å¦‚ï¼š$1\times 1$ï¼Œ$3\times 3$ã€‚

**æ³¨æ„**ï¼Œä»¥ä¸Šå†…å®¹éƒ½æè¿°çš„æ˜¯**æ ‡å‡†å·ç§¯**ï¼Œéšç€æŠ€æœ¯çš„å‘å±•ï¼Œåç»­é™†ç»­æå‡ºäº†åˆ†ç»„å·ç§¯ã€æ·±åº¦å¯åˆ†ç¦»å·ç§¯ã€ç©ºæ´å·ç§¯ç­‰ã€‚è¯¦æƒ…å¯å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« -[MobileNetv1è®ºæ–‡è¯¦è§£](https://github.com/HarleysZhang/cv_note/blob/master/7-model_compression/%E8%BD%BB%E9%87%8F%E7%BA%A7%E7%BD%91%E7%BB%9C%E8%AE%BA%E6%96%87%E8%A7%A3%E6%9E%90/MobileNetv1%E8%AE%BA%E6%96%87%E8%AF%A6%E8%A7%A3.md)ã€‚

### 2.3ï¼Œå·ç§¯å±‚ api

`Pytorch` æ¡†æ¶ä¸­å¯¹åº”çš„å·ç§¯å±‚ api å¦‚ä¸‹ï¼š

```python
class torch.nn.Conv2d(in_channels, out_channels, kernel_size, stride=1, padding=0, dilation=1, groups=1, bias=True)
```

**ä¸»è¦å‚æ•°è§£é‡Šï¼š**

+ `in_channels`(`int`) â€“ è¾“å…¥ä¿¡å·çš„é€šé“ã€‚
+ `out_channels`(`int`) â€“ å·ç§¯äº§ç”Ÿçš„é€šé“ã€‚
+ `kerner_size`(`int or tuple`) - å·ç§¯æ ¸çš„å°ºå¯¸ã€‚
+ `stride`(`int or tuple`, `optional`) - å·ç§¯æ­¥é•¿ï¼Œé»˜è®¤å€¼ä¸º `1` ã€‚
+ `padding`(`int or tuple`, `optional`) - è¾“å…¥çš„æ¯ä¸€æ¡è¾¹è¡¥å…… `0` çš„å±‚æ•°ï¼Œé»˜è®¤ä¸å¡«å……ã€‚
+ `dilation`(`int or tuple`, `optional`) â€“ å·ç§¯æ ¸å…ƒç´ ä¹‹é—´çš„é—´è·ï¼Œé»˜è®¤å–å€¼ `1` ã€‚
+ `groups`(`int`, `optional`) â€“ ä»è¾“å…¥é€šé“åˆ°è¾“å‡ºé€šé“çš„é˜»å¡è¿æ¥æ•°ã€‚
+ `bias`(`bool`, `optional`) - å¦‚æœ `bias=True`ï¼Œæ·»åŠ åç½®ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```python
###### Pytorchå·ç§¯å±‚è¾“å‡ºå¤§å°éªŒè¯
import torch
import torch.nn as nn
import torch.autograd as autograd
# With square kernels and equal stride
# output_shape: height = (50-3)/2+1 = 24.5ï¼Œå·ç§¯å‘ä¸‹å–æ•´ï¼Œæ‰€ä»¥ height=24.
m = nn.Conv2d(16, 33, 3, stride=2)
# # non-square kernels and unequal stride and with padding
# m = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2))  # è¾“å‡ºshape: torch.Size([20, 33, 28, 100])
# # non-square kernels and unequal stride and with padding and dilation
# m = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2), dilation=(3, 1))  # è¾“å‡ºshape: torch.Size([20, 33, 26, 100])
input = autograd.Variable(torch.randn(20, 16, 50, 100))
output = m(input)

print(output.shape)  # è¾“å‡ºshape: torch.Size([20, 16, 24, 49])
```

## ä¸‰ï¼Œå·ç§¯ç¥ç»ç½‘ç»œ

å·ç§¯ç¥ç»ç½‘ç»œä¸€èˆ¬ç”±å·ç§¯å±‚ã€æ±‡èšå±‚å’Œå…¨è¿æ¥å±‚æ„æˆã€‚

### 3.1ï¼Œæ±‡èšå±‚

é€šå¸¸å½“æˆ‘ä»¬å¤„ç†å›¾åƒæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›é€æ¸é™ä½éšè—è¡¨ç¤ºçš„ç©ºé—´åˆ†è¾¨ç‡ã€èšé›†ä¿¡æ¯ï¼Œè¿™æ ·éšç€æˆ‘ä»¬åœ¨ç¥ç»ç½‘ç»œä¸­å±‚å çš„ä¸Šå‡ï¼Œæ¯ä¸ªç¥ç»å…ƒå¯¹å…¶æ•æ„Ÿçš„æ„Ÿå—é‡ï¼ˆè¾“å…¥ï¼‰å°±è¶Šå¤§ã€‚

æ±‡èšå±‚(Pooling Layer)ä¹Ÿå«å­é‡‡æ ·å±‚(Subsampling Layer)ï¼Œå…¶ä½œç”¨ä¸ä»…æ˜¯è¿›é™ä½å·ç§¯å±‚å¯¹ä½ç½®çš„æ•æ„Ÿæ€§ï¼ŒåŒæ—¶é™ä½å¯¹ç©ºé—´é™é‡‡æ ·è¡¨ç¤ºçš„æ•æ„Ÿæ€§ã€‚

ä¸å·ç§¯å±‚ç±»ä¼¼ï¼Œæ±‡èšå±‚è¿ç®—ç¬¦ç”±ä¸€ä¸ªå›ºå®šå½¢çŠ¶çš„çª—å£ç»„æˆï¼Œè¯¥çª—å£æ ¹æ®å…¶æ­¥å¹…å¤§å°åœ¨è¾“å…¥çš„æ‰€æœ‰åŒºåŸŸä¸Šæ»‘åŠ¨ï¼Œä¸ºå›ºå®šå½¢çŠ¶çª—å£(æœ‰æ—¶ç§°ä¸ºæ±‡èšçª—å£)éå†çš„æ¯ä¸ªä½ç½®è®¡ç®—ä¸€ä¸ªè¾“å‡ºã€‚ç„¶è€Œï¼Œä¸åŒäºå·ç§¯å±‚ä¸­çš„è¾“å…¥ä¸å·ç§¯æ ¸ä¹‹é—´çš„äº’ç›¸å…³è®¡ç®—ï¼Œ**æ±‡èšå±‚ä¸åŒ…å«å‚æ•°**ã€‚ç›¸åï¼Œæ± è¿ç®—æ˜¯ç¡®å®šæ€§çš„ï¼Œæˆ‘ä»¬é€šå¸¸è®¡ç®—æ±‡èšçª—å£ä¸­æ‰€æœ‰å…ƒç´ çš„æœ€å¤§å€¼æˆ–å¹³å‡å€¼ã€‚è¿™äº›æ“ä½œåˆ†åˆ«ç§°ä¸º**æœ€å¤§æ±‡èšå±‚**(maximum pooling)å’Œ**å¹³å‡æ±‡èšå±‚**(average pooling)ã€‚

åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œä¸äº’ç›¸å…³è¿ç®—ç¬¦ä¸€æ ·ï¼Œæ±‡èšçª—å£ä»è¾“å…¥å¼ é‡çš„å·¦ä¸Šâ»†å¼€å§‹ï¼Œä»å·¦å¾€å³ã€ä»ä¸Šå¾€ä¸‹çš„åœ¨è¾“å…¥å¼ é‡å†…æ»‘åŠ¨ã€‚åœ¨æ±‡èšçª—å£åˆ°è¾¾çš„æ¯ä¸ªä½ç½®ï¼Œå®ƒè®¡ç®—è¯¥çª—å£ä¸­è¾“å…¥å­å¼ é‡çš„æœ€å¤§å€¼æˆ–å¹³å‡å€¼ã€‚è®¡ç®—æœ€å¤§å€¼æˆ–å¹³å‡å€¼æ˜¯å–å†³äºä½¿ç”¨äº†æœ€å¤§æ±‡èšå±‚è¿˜æ˜¯å¹³å‡æ±‡èšå±‚ã€‚

![æœ€å¤§æ±‡èšå±‚è®¡ç®—ç»“æœ](../images/conv/pool_cal2.png)

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸å·ç§¯å±‚ä¸€æ ·ï¼Œæ±‡èšå±‚ä¹Ÿå¯ä»¥é€šè¿‡æ”¹å˜å¡«å……å’Œæ­¥å¹…ä»¥è·å¾—æ‰€éœ€çš„è¾“å‡ºå½¢çŠ¶ã€‚

### 3.2.ï¼Œèšåˆå±‚ api

`Pytorch` æ¡†æ¶ä¸­å¯¹åº”çš„èšåˆå±‚ api å¦‚ä¸‹ï¼š

```python
class torch.nn.MaxPool2d(kernel_size, stride=None, padding=0, dilation=1, return_indices=False, ceil_mode=False)
```

**ä¸»è¦å‚æ•°è§£é‡Š**ï¼š

+ `kernel_size`(`int or tuple`)ï¼š`max pooling` çš„çª—å£å¤§å°ã€‚
+ `stride`(`int or tuple`, `optional)ï¼š`max pooling` çš„çª—å£ç§»åŠ¨çš„æ­¥é•¿ã€‚é»˜è®¤å€¼æ˜¯ `kernel_size`ã€‚
+ `padding`(`int or tuple`, `optional`)ï¼š**é»˜è®¤å€¼ä¸º `0`ï¼Œå³ä¸å¡«å……åƒç´ **ã€‚è¾“å…¥çš„æ¯ä¸€æ¡è¾¹è¡¥å…… `0` çš„å±‚æ•°ã€‚
+ `dilation`ï¼šæ»‘åŠ¨çª—ä¸­å„å…ƒç´ ä¹‹é—´çš„è·ç¦»ã€‚
+ `ceil_mode`ï¼šé»˜è®¤å€¼ä¸º `False`ï¼Œå³ä¸Šè¿°å…¬å¼é»˜è®¤å‘ä¸‹å–æ•´ï¼Œå¦‚æœè®¾ä¸º `True`ï¼Œè®¡ç®—è¾“å‡ºä¿¡å·å¤§å°çš„æ—¶å€™ï¼Œå…¬å¼ä¼šä½¿ç”¨å‘ä¸Šå–æ•´ã€‚

> `Pytorch` ä¸­æ± åŒ–å±‚é»˜è®¤`ceil mode = false`ï¼Œè€Œ `Caffe` åªå®ç°äº† `ceil mode= true` çš„è®¡ç®—æ–¹å¼ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```python
import torch
import torch.nn as nn
import torch.autograd as autograd
# å¤§å°ä¸º3ï¼Œæ­¥å¹…ä¸º2çš„æ­£æ–¹å½¢çª—å£æ± 
m = nn.MaxPool2d(kernel_size=3, stride=2, padding=1)
# pool of non-square window
input = autograd.Variable(torch.randn(20, 16, 50, 32))
output = m(input)
print(output.shape)  # torch.Size([20, 16, 25, 16])
```

## å››ï¼Œå·ç§¯ç¥ç»ç½‘ç»œç»“æ„

ä¸€ä¸ªå…¸å‹çš„å·ç§¯ç½‘ç»œç»“æ„æ˜¯ç”±å·ç§¯å±‚ã€æ±‡èšå±‚ã€å…¨è¿æ¥å±‚äº¤å‰å †å è€Œæˆã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![å…¸å‹çš„å·ç§¯ç½‘ç»œæ•´ä½“ç»“æ„](../images/conv/cnn_structure.png)

ä¸€ä¸ªç®€å•çš„ `CNN` ç½‘ç»œè¿æ¥å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚

> ç»å…¸ `CNN` ç½‘ç»œçš„æ€»ç»“ï¼Œå¯å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç« -[ç»å…¸ backbone ç½‘ç»œæ€»ç»“](https://github.com/HarleysZhang/cv_note/blob/master/5-deep_learning/%E7%BB%8F%E5%85%B8backbone%E8%AF%A6%E8%A7%A3/%E7%BB%8F%E5%85%B8backbone%E6%80%BB%E7%BB%93.md)ã€‚

![ä¸€ä¸ªç®€å•çš„cnnç½‘ç»œç»“æ„å›¾](../images/conv/cnn_demo1.jpeg)ç›®å‰ï¼Œå·ç§¯ç½‘ç»œçš„æ•´ä½“ç»“æ„è¶‹å‘äºä½¿ç”¨æ›´å°çš„å·ç§¯æ ¸(æ¯”å¦‚ $1 \times 1$ å’Œ $3 \times 3$) ä»¥åŠæ›´æ·±çš„ç»“æ„(æ¯”å¦‚å±‚æ•°å¤§äº 50)ã€‚å¦å¤–ï¼Œç”±äºå·ç§¯å±‚çš„æ“ä½œæ€§è¶Šæ¥è¶Šçµæ´»ï¼ˆåŒæ ·å¯å®Œæˆå‡å°‘ç‰¹å¾å›¾åˆ†è¾¨ç‡ï¼‰ï¼Œæ±‡èšå±‚çš„ä½œç”¨è¶Šæ¥è¶Šå°ï¼Œå› æ­¤ç›®å‰çš„å·ç§¯ç¥ç»ç½‘ç»œé€æ¸è¶‹å‘äºå…¨å·ç§¯ç½‘ç»œã€‚

å¦å¤–ï¼Œå¯é€šè¿‡è¿™ä¸ª[ç½‘ç«™](https://poloclub.github.io/cnn-explainer/#article-convolution)å¯è§†åŒ– `cnn` çš„å…¨éƒ¨è¿‡ç¨‹ã€‚

![cnn_explainer](../images/conv/cnn_explainer.png)

## å‚è€ƒèµ„æ–™

1. [AI EDU-17.3 å·ç§¯çš„åå‘ä¼ æ’­åŸç†](https://microsoft.github.io/ai-edu/%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/A2-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/%E7%AC%AC8%E6%AD%A5%20-%20%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/17.3-%E5%8D%B7%E7%A7%AF%E7%9A%84%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E5%8E%9F%E7%90%86.html)
2. [Visualizing the Feature Maps and Filters by Convolutional Neural Networks](https://medium.com/dataseries/visualizing-the-feature-maps-and-filters-by-convolutional-neural-networks-e1462340518e)
3. ã€Šç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ ã€‹-ç¬¬5ç« 
4. ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹-ç¬¬6ç« 
5. https://www.zhihu.com/question/22298352
